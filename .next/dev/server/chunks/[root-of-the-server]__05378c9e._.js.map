{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Rakib/Learning/shortner-new/app/api/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\nimport crypto from 'crypto';\r\n\r\n/**\r\n * POST handler for user login. Expects a JSON payload containing a\r\n * username and password. If the credentials are valid, a cookie\r\n * named `username` is set on the response which is used to\r\n * authenticate subsequent API requests. Passwords are stored as\r\n * SHA-256 hashes in the `data/users.json` file.\r\n */\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { username, password } = await req.json();\r\n    if (typeof username !== 'string' || typeof password !== 'string' || !username || !password) {\r\n      return NextResponse.json({ error: 'Invalid request' }, { status: 400 });\r\n    }\r\n    const dataDir = path.join(process.cwd(), 'data');\r\n    await fs.mkdir(dataDir, { recursive: true });\r\n    const usersFile = path.join(dataDir, 'users.json');\r\n    let users: Record<string, string> = {};\r\n    try {\r\n      users = JSON.parse(await fs.readFile(usersFile, 'utf8'));\r\n    } catch {\r\n      users = {};\r\n    }\r\n    const storedHash = users[username];\r\n    if (!storedHash) {\r\n      return NextResponse.json({ error: 'Invalid username or password' }, { status: 401 });\r\n    }\r\n    const providedHash = crypto.createHash('sha256').update(password).digest('hex');\r\n    if (providedHash !== storedHash) {\r\n      return NextResponse.json({ error: 'Invalid username or password' }, { status: 401 });\r\n    }\r\n    // Set the username cookie. We deliberately do not mark it as\r\n    // httpOnly so that client-side fetch requests can include it\r\n    // automatically. Adjust maxAge as needed (e.g. session cookie).\r\n    const res = NextResponse.json({ success: true });\r\n    res.cookies.set('username', username, { path: '/' });\r\n    return res;\r\n  } catch (err) {\r\n    console.error('POST /api/login error:', err);\r\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AASO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAC7C,IAAI,OAAO,aAAa,YAAY,OAAO,aAAa,YAAY,CAAC,YAAY,CAAC,UAAU;YAC1F,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QACA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QACzC,MAAM,gIAAE,CAAC,KAAK,CAAC,SAAS;YAAE,WAAW;QAAK;QAC1C,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,SAAS;QACrC,IAAI,QAAgC,CAAC;QACrC,IAAI;YACF,QAAQ,KAAK,KAAK,CAAC,MAAM,gIAAE,CAAC,QAAQ,CAAC,WAAW;QAClD,EAAE,OAAM;YACN,QAAQ,CAAC;QACX;QACA,MAAM,aAAa,KAAK,CAAC,SAAS;QAClC,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA+B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QACA,MAAM,eAAe,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,UAAU,MAAM,CAAC;QACzE,IAAI,iBAAiB,YAAY;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA+B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QACA,6DAA6D;QAC7D,6DAA6D;QAC7D,gEAAgE;QAChE,MAAM,MAAM,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;QAC9C,IAAI,OAAO,CAAC,GAAG,CAAC,YAAY,UAAU;YAAE,MAAM;QAAI;QAClD,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}